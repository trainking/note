# Box2D

**Box2D** 是一个开源（基于MIT协议）的2D物理引擎，详情访问[box2d.org](https://box2d.org/)。使用可移植的C++写成，引擎定义的类型，都是以b2前缀开头。

## 安装

### 类Linux

类Liux系统，只需要将代码clone下来，直接执行`build.sh`脚本即可。可能会报确实`cmake`工具，安装即可。

### windows

windows下，使用提供的`build.bat`会报一个`缺失sln`的错误。也是缺失`cmake`工具导致，安装好`cmake`工具之后，同时要有Visual Studio工具，便可以编译成功。

## 基础知识

物理模拟在计算机图形模拟中，无处不在。游戏开发中，物理模拟是为了反馈给玩家更加真实的效果。或者说，至少是玩家觉得像一种真实的反馈。因此，对基本物理知识质量，力，扭矩等等这些了解是必须的。

### 世界（Wrold）

一个物理世界就是物体，形状和约束相互作用的集合。也可以看作，一个世界就是一个容器。将创建的2D对象，都是需要放到一个世界里面。或者说，依赖世界来创建。**Box2D**可以创建多个世界，但这通常是不必要的。

### 刚体（Rigid Body）

固定不变的物质，像一块石头。它之上的任何两点之间的距离都是完全不变的（不具有弹性），硬直的，那些不会压缩的物体。

### 形状（Shape）

严格附于物体之上的2D碰撞集合结构。形状具有摩擦（friction）和恢复（restitution）的材料兴致。

### 约束（Constraint）

约束是消除物体自由度的物理连接，在2D世界中，物体有3个自由度（水平，垂直，旋转）。如果我们把一个物体钉在墙上(像钟摆那样), 那就把它约束到了墙上。这个时候,此物体就只能绕着钉子旋转, 所以这个约束消除了它2个自由度。

### 接触约束（Contact Constraint）

一种特殊的约束，设计的目的是为了防止刚体被穿透，也用于模拟摩擦和恢复。接触约束不用主动创建，她们会自动被Box2d生成。

### 夹具（Fixture）

夹具将形状绑定到物体之上，并具有一定的材质属性，比如密度(density), 摩擦(friction)和恢复(restitution)。

### 关节（Joint）

关节就是中约束，将两个或多个Body固定在一起。Box2D支持不同的关节类型:转动(revolute),棱柱(prismatic),距离(distance)等。一些关节可以有限制(limits)和马达(motors)。

### 关节限制（Joint Limit）

关节限制限定了一个关节的运动范围。例如，人类的胳膊只能在某一个角度范围内运动。

### 关节马达（Joint Motor）

根据关节的自由度，关节马达可以驱动关节连接的物体。可以使用一个马达来驱动一个肘的旋转。

### 向量和坐标系

**Box2D**是二维的物理引擎，所以它采用的是笛卡尔坐标系， 以左顶点为原点`(0,0)`, 以米为单位。**向量**（vector）是一个从数学物理学到计算机图形学等等中，基础的概念。指同时一个具有大小和方向，且满足平行四边形法则的集合对象。在计算机图形学中，向量的定义与物理学工程学中一致，也被称之为矢量或欧几里得向量，如运动学中的位移，速度，加速度，力学中的力，力矩等等，都可以用向量来描述。

### 碰撞

**碰撞**是现实世界常见一种场景，而在计算机图形世界里面。是否发生碰撞，并不能像现实世界那样，自然而然发生。而是需要，通过计算方式，计算两个图形（模型）是否发生了解除（相交）。故而，便有了**碰撞检测**。

### Box2d是如何工作的？

任何物理引擎，都必须要先绘制一个基础的世界。任何物理事件，都发生在这个世界之中。**Box2d**是一个2d的平面引擎，所以它必须先创建一个二维的平面。

其次，需要创建（绘制）在此平面上运动的物体。然后计算它们：

* 计算输入参数（施力，加速度等）的在场景（世界）运动轨迹
* 检测物体是否发生碰撞
* 碰撞之后的运动轨迹

## 快速开始

### 1. 创建一个世界

**Box2D**的程序都是基于一个`b2World`对象开始。**这个对象是管理内存，对象和模拟的物理中心**。创建一个`b2World`对象，需要两步：

```cpp
b2Vec2 gravity(0.0f, -10.0f);
b2World world(gravity);
```

也可以简化为：

```cpp
b2World world({ 0.0f, -10.0f });
```

### 2. 创建一个地面

首先，创建地面需要一个物体定义（Body Definition），通过物体定义指定地面体的初始位置：

```cpp
b2BodyDef groundBodyDef;
groundBodyDef.position.Set(0.0f, -10.0f);
```

将物体传给世界对象，创建地面体：

```cpp
b2Body* ground = world.CreateBody(&groundBodyDef);
```

