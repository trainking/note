# Box2D

**Box2D** 是一个开源（基于MIT协议）的2D物理引擎，详情访问[box2d.org](https://box2d.org/)。使用可移植的C++写成，引擎定义的类型，都是以b2前缀开头。

## 安装

### C++版本

#### 类Linux

类Liux系统，只需要将代码clone下来，直接执行`build.sh`脚本即可。可能会报确实`cmake`工具，安装即可。

#### windows

windows下，使用提供的`build.bat`会报一个`缺失sln`的错误。也是缺失`cmake`工具导致，安装好`cmake`工具之后，同时要有Visual Studio工具，便可以编译成功。

### C#版本

C#版本使用：

```url
https://github.com/Zonciu/Box2DSharp
```

## 基础知识

物理模拟在计算机图形模拟中，无处不在。游戏开发中，物理模拟是为了反馈给玩家更加真实的效果。或者说，至少是玩家觉得像一种真实的反馈。因此，对基本物理知识质量，力，扭矩等等这些了解是必须的。

### 世界（Wrold）

一个物理世界就是物体，形状和约束相互作用的集合。也可以看作，一个世界就是一个容器。将创建的2D对象，都是需要放到一个世界里面。或者说，依赖世界来创建。**Box2D**可以创建多个世界，但这通常是不必要的。

### 物体（Body）

`Body`是世界存在的基础对象，后续介绍的各种约束和夹具，形状等等，都是一个Strcut结构体。他们传递给Body，应用到World中。`Body`通过`BodyType`来定义不同类型的物体，有三种类型：

* StaticBody: 0质量，0速度，可以被手动移动
* KinematicBody：0质量，用户指定的速度，可以被系统移动
* DynamicBody：正整数的质量，速度由力量决定，可以被系统移动

### 形状（Shape）

严格附于物体之上的2D碰撞集合结构。形状具有摩擦（friction）和恢复（restitution）的材料兴致。

* EdgeShape：边形状，可以理解为一堵墙
* CircleShape: 圆形
* PolygonShape：多边形

### 约束（Constraint）

约束是消除物体自由度的物理连接，在2D世界中，物体有3个自由度（水平，垂直，旋转）。如果我们把一个物体钉在墙上(像钟摆那样), 那就把它约束到了墙上。这个时候,此物体就只能绕着钉子旋转, 所以这个约束消除了它2个自由度。

### 接触约束（Contact Constraint）

一种特殊的约束，设计的目的是为了防止刚体被穿透，也用于模拟摩擦和恢复。接触约束不用主动创建，她们会自动被Box2d生成。

### 夹具（Fixture）

夹具将形状绑定到物体之上，并具有一定的材质属性，比如密度(density), 摩擦(friction)和恢复(restitution)。

### 关节（Joint）

关节就是中约束，将两个或多个Body固定在一起。Box2D支持不同的关节类型:转动(revolute),棱柱(prismatic),距离(distance)等。一些关节可以有限制(limits)和马达(motors)。

### 关节限制（Joint Limit）

关节限制限定了一个关节的运动范围。例如，人类的胳膊只能在某一个角度范围内运动。

### 关节马达（Joint Motor）

根据关节的自由度，关节马达可以驱动关节连接的物体。可以使用一个马达来驱动一个肘的旋转。



### 物理知识

#### 向量和坐标系

**Box2D**是二维的物理引擎，所以它采用的是笛卡尔坐标系， 以左顶点为原点`(0,0)`, 以米为单位。**向量**（vector）是一个从数学物理学到计算机图形学等等中，基础的概念。指同时一个具有大小和方向，且满足平行四边形法则的集合对象。在计算机图形学中，向量的定义与物理学工程学中一致，也被称之为矢量或欧几里得向量，如运动学中的位移，速度，加速度，力学中的力，力矩等等，都可以用向量来描述。

Box2D中，使用了`Vector2`结构体表达向量，它有两个构造函数：

```C#
public Vector2(float value);
public Vector2(float x, float y);
```

#### 质量

质量（Mass）是物体的**惯性**相关的重要参数，Box2D的Body对象，都可以通过`MassData`设置物体的质量参数：

```c#
    public struct MassData
    {
        /// 重量大小，使用kg为单位
        public float Mass;

        /// 质心相对形状远点的位置，例如圆形就是(0,0)
        public Vector2 Center;

        /// 形状关于局部原点的转动惯量
        public float RotationInertia;
    }
```

#### 密度

密度（Density）是物体形状大小平均分配到物体的密度，决定了**接触点**可以触发的碰撞力。Box2D使用一个float类型，接受物体的密度。密度是由，质量除以面积平方得出。

```
Density = kg/m^2
```

#### 角速度

角速度（AngularVelocity）是用来描述物体转动或一质点绕另一质点转动的快慢和转动方向的物理量。简单来说，就是决定物体的旋转的快慢。Box2D中，使用`m/s`为单位。

#### 线性速度

线性速度（LinearVelocity）物体运动的速度。表现为，物体在世界中的运动速度，通过一个`Vector2`接口来确定方向，然后乘以速度倍数，得到速度的值。Box2D中，使用`m/s`为单位。

#### 作用力

作用力（Force）是改变物体运动状态和形变的根本原因。Box2D的施加力的过程取药确定三个参数：

* 力的大小：一个`Vector2`向量
* 施力的点：施加力在物体的哪个点
* Awake状态：施力后是否唤醒物体

#### 摩擦力

摩擦力（Friction）是两个物体相交事，相互之间产生的摩擦力。Box2D可以给物体添加一个摩擦系数，大小在`0~1f`之间的浮点数。

#### 恢复（弹性）

恢复（Restitution）是物体相撞，产生弹力的重要系数。Box2D可以给物体添加一个恢复系数，大小在`0~1f`之间的浮点数。同时， 提供了另一个恢复速度阈值（RestitutionThreshold），通常以 m/s 为单位。超过此速度的碰撞会应用恢复原状（会反弹）。

#### 阻尼

阻尼（Damping）是指摇荡系统或振动系统受到阻滞使能量随时间而耗散的物理现象。例如，给物体施加一个力，物体运动一定距离后，停止的过程，就是由物体的阻尼系数决定。

Box2D有两个物体阻尼，分为**线性阻尼（LinearDamping）**和**角阻尼（AngularDamping）**，分别影响线性速度和角速度。

#### 扭矩

扭矩（Torque）物理中特殊的力矩，等于力和力臂的乘积。是使物体发生转动的一种特殊的力矩，单位是牛米N·m。**扭矩与转速成反比关系**。

## 快速开始

### 1. 创建一个世界

**Box2D**的程序都是基于一个`b2World`对象开始。**这个对象是管理内存，对象和模拟的物理中心**。创建一个`b2World`对象，需要两步：

```cpp
b2Vec2 gravity(0.0f, -10.0f);
b2World world(gravity);
```

也可以简化为：

```cpp
b2World world({ 0.0f, -10.0f });
```

### 2. 创建一个地面

首先，创建地面需要一个物体定义（Body Definition），通过物体定义指定地面体的初始位置：

```cpp
b2BodyDef groundBodyDef;
groundBodyDef.position.Set(0.0f, -10.0f);
```

将物体传给世界对象，创建地面体：

```cpp
b2Body* ground = world.CreateBody(&groundBodyDef);
```

